// Docker plugin
apply plugin: "docker"
// Docker plugin configuration
task dockerBuild(type: Docker, dependsOn: [jar, test]) {
    // dockerBuild options
    applicationName = jar.baseName
    dockerfile = file("src/main/docker/Dockerfile")
    push = false
    registry = "pooh.serin-consultancy.co.uk"
    tagVersion = "latest"

    // Add files to Docker context
    doFirst {
        copy { from jar into stageDir }
        copy { from "src/main/docker/docker-entrypoint.sh" into stageDir }
    }

    // Only enable if a Dockerfile exists
    enabled = file(projectDir.toString() + '/src/main/docker/Dockerfile').isFile()

    // Add to build lifecycle
    assemble.dependsOn dockerBuild
}